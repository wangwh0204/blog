title: JavaScript DOM编程艺术
date: 2015-10-09
updated: 2015-11-09
categories: 
- [reading]
- [technology]
tags: 
- javascript
- dom
---

&lt;&lt;JavaScript DOM编程艺术&gt;&gt;读书笔记。入门书籍，动态语言太过灵活，是一把双刃剑，不适合初学者作为第一门语言，在熟手手里是高效的工具，在新手手里是混乱的源头。 断断续续一个月时间才看完<!--more-->

# 01 JavaScript简史
JavaScript的第一个版本，即JavaScript 1.0版本，出现在1995年推出的Netscape Navigator2浏览器中。
JavaScript与Sun公司开发的Java程序语言没有任何联系。JavaScript是一种脚本语言。
DOM是一套对文档的内容进行抽象和概念化的方法。

# 02 JavaScript语法
用JavaScript编写的代码必须通过HTML/XHTML文档才能执行。有两种方式可以做到这点：
- 将JavaScript代码放到文档<head>标签中的<script>标签之间
<head> <scirpt> javascript code </script> </head>
- 更好的方式把JavaScript代码存为一个扩展名为.js的独立文件，并把<script>标签放在HTML文档的最后，</body>标签之前
<body> ... <script src="file.js"> </script> </body>


解释型语言不需要编译器--它们仅需要解释器。对于JavaScript语言，在互联网环境下，Web浏览器负责完成完成有关的解释和执行工作。浏览器中的JavaScript解释器将直接读入源代码并执行。

JavaScript的语法与Java和C++语言的语法非常相似。

用"//"注释单行，用"/* ... */"注释多行

JavaScript允许程序员直接对变量赋值而无需事先声明。

必须明确类型声明的语言称为强类型(strongly typed)语言。JavaScript不需要进行类型声明，因此它是一种弱类型（weakly typed)语言。这意味着程序员可以在任何阶段改变变量的数据类型。

JavaScript数据类型：
1. 字符串
字符串由零个或多个字符构成，字符包括但不限于字母，数字，标点符号和空格。
2. 数值
整数，浮点
3. 布尔值

在JavaScript中， **数组** 用关键字Array声明。事实上，只需一对方括号把各个元素的初始值括起来就可以了：
var beatles = ["John", "Paul", "George", "Ringo"];
甚至可以把这3种数据类型混在一起存入一个数组：
var lennon = ["John", 1940, false];

数组还可以包含其他的数组，数组中的任何一个元素都可以把一个数组作为它的值：
var lennon = ["John", 1940, false];
var beatles = [];
beatles[0] = lennon;

与数组类似, **对象** 也是使用一个名字表示一组值。对象的每个值都是对象的一个属性：
var lennon = Object();
lennon.name = "John";
lennon.year = 1940;
lennon.living = false;

与使用Array类似，创建对象使用Object关键字，它不使用方括号和下标来获取元素，而是像任何JavaScript对象一样，使用点号来获取属性。创建对象还有一种更简洁的语法，即花括号语法：
var lennon = {name:"John", year:1940, living:false};
属性名与JavaScript变量的命名规则有相同之处，属性值可以是任何JavaScript值，包括其他对象。

操作(operation) // ... 运算符被翻译成了 操作
arithmetic operatioin : =, +, -, *, /

比较操作符 ： ==, >, <, >=, <=, ===, !==

if () {
} else {
}

while () {
}

do {
} while();

for (initial condition; test condition; alter condition) {
statments;
}

function

可以使用var关键字明确地为函数变量设定作用域。如果在某个函数中使用了var，那个变量就将被视为一个局部变量，它只存在于这个函数的上下文中；反之，如果没有使用var，那个变量就被视为一个全区变量，如果脚本里面已经存在一个与之同名的全局变量，这个函数就会改变那个全局变量的值。


# 03 DOM
对象是一种自足的数据集合。与某个特定对象相关联的变量被称为对象的 属性；只能通过某个特定对象去调用的函数被称为这个对象的 方法。

JavaScript语言里的对象可以分为三种类型：
- 用户定义对象(user-defined object) : 由程序员自行创建的对象.
- 内建对象(native object)：内建在JavaScript语言里的对象，如Array, Math和Date.
- 宿主对象(host object) ： 由浏览器提供的对象. window, document

DOM将一份文档表示为一棵树，这是我们理解和运用这一模型的关键。文档是由节点(Node)构成的集合。
节点分为不同的类型：Element node, text node, attribute node

DOM并不是与网页结构打交道的唯一技术。我们还可以通过CSS(层叠样式表)告诉浏览器应该如何显示一份文档的内容。

继承(inheritance)是CSS技术中的一项强大功能。类似于DOM，CSS也把文档的内容视为一棵节点树。节点树上的各个元素将继承其父元素的样式属性。
selector {
  property: value;
}

在某些场合，当把样式应用于一份文档时，我们其实只是想让那些样式作用于某个特定的元素。例如，我们只想让某一段文本变成某种特殊的颜色和字体，但不想让其他段落受到影响。为了获得如此精细的控制，需要在文档里插入一些能够把这段文本与其他段落区别开来的特殊标志。

为了把某一个或某几个元素与其他元素区别开来，需要使用class属性或id属性。
1. class属性
可以在所有的元素上任意应用class属性：
<p class="special"> This paragraph has the special class</p>
<h2 class="special"> So does this headline </h2>

在样式表里，可以像下面这样为class属性值相同的所有元素定义同一种样式：
.special {
 font-style: italic;
}
还可以像下面这样利用class属性为一种特定类型的元素定义一种特定的样式：
h2.special {
 text-transform: uppercase;
}
2. id属性
id属性的用途是给网页里的某个元素加上一个独一无二的标识符。<ul id="purchases">
在样式表里，可以像下面这样为有特定id属性值的元素定义一种独享的样式：
#purchases {
 border: 1px solid white;
 background-color: #333;
 color: #ccc;
 padding: 1em;
}

有3种DOM方法可获取元素节点，分别是通过元素ID，通过标签名字和通过类名来获取。
1. getElementById
DOM提供了一个名为getElementById的方法，这个方法将返回一个与那个有着给定id属性值的元素节点对应的对象。
JavaScript语言区分字母大小写。
typeof操作符可以告诉我们它的操作数是一个字符串，数值，函数，布尔值还是对象。
2. getElementsByTagName
返回一个对象数组，每个对象分别对应文档里有着给定标签的一个元素。
3. getElementsByClassName
这个方法让我们能够通过class属性中的类名来访问元素。

获取节点元素后，通过节点对象的getAttribute方法获取节点元素的属性，相应地，setAttribute方法可以更改属性节点的值。

# 04 案例研究：JavaScript图片库
this
- childNodes属性
在一棵节点树上，childNodes属性可以用来获取任何一个元素的所有子元素，它是一个包含这个元素全部子元素的数组。 
- nodeType属性
element node的nodeType属性值是1
attribute node的nodeType属性值是2
text node的nodeType属性值是3

下一章将介绍一些JavaScript脚本编程方面的最佳实践，你会从中领悟这样一个道理：达成目标的过程与目标本身同样重要。


# 05 最佳实践
- 平稳退化 ： 确保网页在没有JavaScript的情况下也能正常工作
- 分离JavaScript : 把网页的结构和内容与JavaScript脚本的动作行为分开
- 向后兼容性 ： 确保老版本的浏览器不会因为你的JavaScript脚本而死掉 
- 性能考虑 ： 确定脚本执行的性能最优

易学易用的技术就像一把双刃剑。因为容易学习和掌握，它们往往会在很短的时间内就为人们广泛接受，但也往往意味着缺乏高水平的质量控制措施。

正如物理学中的运动与惯性定律所描述的那样，如果人们在开始使用一种新技术时没有经过深思熟虑，而这种新技术又很快地成为了一种潮流，则纠正在早期阶段养成的坏习惯将会非常困难。

平稳退化：
如果正确地使用了JavaScript脚本，就可以让访问者在他们的浏览器不支持JavaScript的情况下仍能顺利地浏览你的网站。这就是所谓的 *平稳退化* (graceful degradation),就是说，虽然某些功能无法使用，但是最基本的操作仍能顺利完成。

想象一下，有个访问者来到了你的网站，他总是在浏览Web时同时禁用图像和JavaScript。你肯定认为如今这样的用户已非常少见，而事实也正是如此。但这个访问者非常重要。你想象的那个用户时一个 *搜索机器人(searchbot)* .搜索机器人是一种自动化的程序，它们浏览Web的目的是为了把各种网页添加到搜索引擎的数据库里。目前只有极少数搜索机器人能够理解JavaScript代码，所以，如果你的JavaScript网页不能平稳退化，它们在搜索引擎上的排名就可能大受损害。

CSS可以让人们对网站设计工作中的各个方面作出严格细致的控制。CSS技术的最大优点是，它能够帮助你将web文档的内容结构(标记)和版面设计(样式)分离开来。真正能从CSS技术获益的方法，是把样式全部转移到外部文件中去。

作为CSS技术的突出优点，文档结构与文档样式的分离可以确保网页都能平稳退化。具备CSS支持的浏览器固然可以把网页呈现得美轮美奂，不支持或者禁用了CSS功能的浏览器同样可以把网页的内容按照正确的结构显示出来。


内容需要用HTML或者XHTML之类的标记语言来描述。在创建网站的时候，给内容加上正确的HTML标记是第一个步骤，或许也是最重要的步骤。
> 我的理解是标记 定义了 UI 组件

在给内容加上各种标记后，就可以使用各种CSS指令控制内容的显示效果。CSS指令构成了一个表示层。这个表示层就像一张透明的彩色薄膜，可以包裹到文档的结构上，使文档的内容呈现出各种色彩。但即使去掉这个表示层，文档的内容也依然可以访问(只是缺乏色彩而已).

所谓"渐进增强"就是用一些额外的信息层去包裹原始数据。按照"渐进增强"原则创建出来的网页几乎都符合"平稳退化"原则.
> 通过增加 间接层，做到 内容 与 样式 分离

类似于CSS,JavaScript和DOM提供的所有功能也应该构成一个额外的指令层。CSS代码负责提供关于"表示"的信息，JavaScrit代码负责提供关于"行为"的信息。行为层的应用方式与表示层一样。

值得推荐的方法是，先把样式信息存入一个外部文件，再在文档的head部分用<link>标签来调用这个文件。
class属性是样式与文档内容之间的联结纽带。

类似于使用style属性，在HTML文档里使用诸如onclick之类的属性也是一种既没有效率又容易引发问题的做法。如果我们用一个"挂钩"，就像CSS机制中的class或id属性那样，把JavaScript代码调用行为与HTML文档的结构和内容分离开，网页就会健壮得多。

如果JavaScript文件是从HTML文档的<head>部分用<script>标签调用的，它将在HTML文档之前加载到浏览器里。同样，如果<script>标签位于文档底部</body>之前，就不能保证哪个文件最先结束加载(浏览器可能一次加载多个).

在JavaScript脚本代码里，在使用某个特定的方法或属性之前，先测试它是否真实存在是确保向后兼容性最安全和最可信的办法，但它并不是唯一的办法。

在写完了脚本，做了优化，而且也将它放到文档中的时当位置之后，还有一件事可以加快加载速度：压缩脚本文件。所谓压缩脚本，指的是把脚本文件中不必要的字节，如空格和注释，统统删除，从而达到"压缩"文件的目的。精简后的代码虽然不容易看懂，却能大幅减少文件大小。多数情况下，你应该有两个版本，一个是工作副本，可以修改代码并添加注释；另一个是精简副本，用于放在站点上。通常，为了与非精简版本区分开，最好在精简副本的文件名中加上min字样。

# 06 案例研究：图片库改进版
正如在上一章里看到的那样，与DOM脚本编程工作有关的问题不外乎平稳退化，向后兼容和分离JavaScript这几个大类。这些问题的解决方式和解决程度影响着网页的可用性和可访问性。

# 07 动态创建标记
## 传统方法
- document.write
document对象的write()方法可以方便快捷地把字符串插入到文档里. document.write的最大缺点是它违背了"行为应该与表现分离"的原则。
从某种意义上讲，使用 document.write方法有点儿像使用<font>标签去设定字体和颜色。虽然这两种技术在HTML文档里都工作的不错，但它们都不够优雅。

把结构，行为和样式分开永远都是一个好主意。只要有可能，就应该用外部CSS文件代替<font>标签去设定和管理网页的样式信息，最好用外部JavaScript文件去控制网页的行为。应该避免在<body>部分乱用<script>标签，避免使用document.write方法。

- innerHTML
innerHTML属性可以用来读，写某给定元素里的HTML内容。在需要把一大段HTML内容插入一份文档时，innerHTML属性可以让你又快又简单地完成这一任务。

## DOM方法
在浏览器看来，DOM节点树才是文档。一旦明白这个道理，以动态方式实时创建标记就不那么难以理解了。你并不是在创建标记，而是在改变DOM节点树。做到这一点的关键是一定要从DOM的角度去思考问题。


## Ajax
2005年, Adaptive Path公司的Jesse James Garrett发明了Ajax这个词，用于概括异步加载页面内容的技术。使用Ajax可以做到只更新页面中的一小部分。Ajax的主要优势就是对页面的请求以异步方式发送到服务器。而服务器不会用整个页面来响应请求，它会在后台处理请求，与此同时用户还能继续浏览页面并与页面交互。

Ajax技术的核心就是XMLHttpRequest对象。这个对象充当着浏览器中的脚本与服务器之间的中间人的角色，以往的请求都由浏览器发出，而JavaScript通过这个对象可以自己发送请求，同时也自己处理响应。

XMLHttpRequest对象有许多的方法。其中最有用的是open方法，它用来指定服务器上将要访问的文件，指定请求类型：GET，POST或SEND。这个方法的第三个参数用于指定请求是否以异步方式发送和处理。

要构建成功的Ajax应用，关键在于将Ajax功能看做一般的JavaScript增强功能，在平稳退化的基础上求得渐进增强。构建Ajax网站的最好方法，也是先构建一个常规的网站，然后hijax它。

Ajax应用主要依赖后台服务器，实际上是服务器端的脚本语言完成了绝大部分工作。XMLHttpRequest对象作为浏览器与服务器之间的中间人，它只是负责传递请求和响应。如果把这个中间人请开，浏览器与服务器之间的请求和响应应该继续完成(而不是中断)，只不过花的时间可能会长一点点。

# 08 充实文档的内容
<abbr> 缩略语标签

# 09 CSS-DOM
我们在浏览器里看到的网页其实是由以下三层信息构成的一个共同体：
- 结构层
网页的结构层(structural layer)由HTML或XHTML之类的标记语言负责创建。标签并不包含任何关于内容如何显示的信息。
- 表示层
表示层(presentation layer)由CSS负责完成。CSS描述页面内容应该如何呈现。
- 行为层
行为层(behavior layer)负责内容应该如何响应事件这一问题。这是JavaScript语言和DOM主宰的领域。

网页的表示层和行为层总是存在的，即使未明确地给出任何具体的指令也是如此。此时，Web浏览器将应用它的默认样式和默认事件处理函数。
在所有的产品设计活动中，选择最适用的工具去解决问题是最基本的原则。具体到网页设计工作，这意味着：
- 使用（X）HTML去搭建文档的结构
- 使用CSS去设置文档的呈现效果
- 使用DOM脚本去实现文档的行为

# 10 用JavaScript实现动画效果
JavaScript能够按照预定的时间间隔重复调用一个函数，而这意味着我们可以随着时间的推移而不断改变某个元素的样式。
动画是样式随时间变化的完美例子之一。简单地说，动画就是让元素的位置随着时间而不断地发生变化。

# 11 HTML5

# 12 综合示例
